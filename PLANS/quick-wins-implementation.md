# Quick Wins Implementation Plans

## 1. PDF Export

### Overview
Add PDF as an export destination, leveraging the existing `ExportService` architecture. PDFs will include the handwritten image, OCR text with formatting, and optional metadata.

### Architecture Decision
**Option A (Recommended):** Add `PDFExporter` as a new `ExportDestination` implementation
- Follows existing patterns
- Reuses `FormattedExportContent` and type-specific formatters
- Integrates naturally with `ExportOptionsSheet`

**Option B:** Standalone PDF generation in detail views
- Simpler but duplicates formatting logic
- Harder to maintain consistency

### Files to Create

#### `QuillStack/Services/Export/PDFExporter.swift`
```swift
// PDFExporter: ExportDestination
// - Uses UIGraphicsPDFRenderer for PDF generation
// - Page layout: Title â†’ Metadata â†’ Original Image â†’ OCR Text
// - Supports multi-page notes with page breaks
// - Optional: Low-confidence word highlighting (orange underline)
```

**Key Implementation Details:**
- PDF page size: 8.5" x 11" (612 x 792 points)
- Margins: 72 points (1 inch)
- Image scaling: Fit to width with aspect ratio preserved
- Font: System serif to match app aesthetic
- Metadata block: Type badge, dates, OCR confidence, tags

### Files to Modify

#### `QuillStack/Services/Export/ExportService.swift`
- Add `.pdf` case to `ExportDestination` enum (or create PDFExporter class)
- Register PDF exporter in destination resolution

#### `QuillStack/Views/Components/ExportOptionsSheet.swift`
- Add PDF to destination picker
- PDF-specific options:
  - Include original image (default: true)
  - Include metadata header (default: true)
  - Highlight low-confidence words (default: false)
  - Paper size selection (Letter/A4)

#### `QuillStack/Views/Notes/NoteDetailView.swift`
- Add "Export to PDF" action in share menu (or use unified export sheet)

### PDF Layout Specification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Type Badge]              QuillStack       â”‚ â† Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚              NOTE TITLE                    â”‚ â† Title (24pt serif bold)
â”‚                                            â”‚
â”‚ Created: Dec 30, 2024  â€¢  OCR: 87%        â”‚ â† Metadata line
â”‚ Tags: work, project-acme                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚                  â”‚              â”‚
â”‚         â”‚  [Handwritten    â”‚              â”‚ â† Original image
â”‚         â”‚   Image]         â”‚              â”‚    (if enabled)
â”‚         â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚ Transcribed Text:                          â”‚ â† Section header
â”‚                                            â”‚
â”‚ Meeting with design team to discuss        â”‚ â† OCR content
â”‚ the new onboarding flow. Key points:       â”‚    (body text)
â”‚                                            â”‚
â”‚ â€¢ Simplify initial setup                   â”‚
â”‚ â€¢ Add progress indicator                   â”‚
â”‚ â€¢ Consider skip option                     â”‚
â”‚                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Page 1 of 2              Generated by QS   â”‚ â† Footer
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation Steps

1. **Create PDFExporter class** conforming to ExportDestination protocol
2. **Implement PDF rendering** using UIGraphicsPDFRenderer
3. **Add type-specific layouts:**
   - Todo: Checkbox items with strikethrough for completed
   - Email: To/Subject/Body sections
   - Meeting: Attendees, Agenda, Action Items sections
   - General: Standard text layout
4. **Handle multi-page notes** with page breaks between NotePage content
5. **Add sharing** via UIActivityViewController (save to Files, AirDrop, etc.)
6. **Update ExportOptionsSheet** with PDF destination and options

### Estimated Scope
- New file: ~200 lines (PDFExporter)
- Modifications: ~50 lines across existing files
- Testing: PDF rendering on various note types

---

## 2. Capture Statistics Dashboard

### Overview
Create a statistics view showing capture patterns, OCR accuracy trends, and learning progress. All data already exists in Core Data.

### Data Sources (Already Available)

| Metric | Source |
|--------|--------|
| Notes per period | `Note.createdAt` grouped by day/week/month |
| Type breakdown | `Note.noteType` aggregation |
| OCR confidence | `Note.ocrConfidence` average over time |
| Corrections made | `OCRCorrection` entity count and frequency |
| Multi-page usage | `Note.pages.count` |
| Enhancement usage | `QueuedEnhancement` completion rates |

### Files to Create

#### `QuillStack/Views/Statistics/StatisticsView.swift`
Main dashboard view with sections for different metrics.

#### `QuillStack/Views/Statistics/CaptureChartView.swift`
Bar chart showing notes captured over time (using Swift Charts).

#### `QuillStack/Views/Statistics/TypeBreakdownView.swift`
Pie/donut chart showing note type distribution.

#### `QuillStack/Views/Statistics/AccuracyTrendView.swift`
Line chart showing OCR confidence improvement over time.

#### `QuillStack/ViewModels/StatisticsViewModel.swift`
Fetches and aggregates data from Core Data for display.

### Files to Modify

#### `QuillStack/App/ContentView.swift`
- Add Statistics tab to TabView (or add as section in Settings)

### Dashboard Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Statistics                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  CAPTURE ACTIVITY                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â– â–ƒ â–… â–ˆâ–ˆ â–ƒ â–… â–‡ â–ƒ â– â–… â–ƒ â–‡         â”‚   â”‚ â† Bar chart
â”‚  â”‚  M T W T F S S M T W T F S         â”‚   â”‚    (last 2 weeks)
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  47 notes this month â€¢ 12 this week        â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  NOTE TYPES                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚   â•­â”€â”€â”€â•®     â”‚  ğŸ“ General: 45%          â”‚
â”‚  â”‚  â•±     â•²    â”‚  âœ“ Todo: 30%              â”‚ â† Pie chart
â”‚  â”‚ â”‚       â”‚   â”‚  ğŸ“§ Email: 15%            â”‚
â”‚  â”‚  â•²     â•±    â”‚  ğŸ“… Meeting: 10%          â”‚
â”‚  â”‚   â•°â”€â”€â”€â•¯     â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  OCR ACCURACY TREND                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚   â”‚ â† Line chart
â”‚  â”‚   â•±                                 â”‚   â”‚    (improving!)
â”‚  â”‚ â•±                                   â”‚   â”‚
â”‚  â”‚ Nov        Dec          Jan         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  Current avg: 87% â€¢ Started at: 72%        â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  LEARNING PROGRESS                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Corrections learned: 34                 â”‚   â”‚
â”‚  â”‚ Most frequent: "meeting" â†’ "meeting"    â”‚   â”‚
â”‚  â”‚ Recent improvement: 15% fewer fixes     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation Steps

1. **Create StatisticsViewModel** with Core Data fetch requests:
   - `fetchCapturesByDate(range:)` â†’ `[Date: Int]`
   - `fetchTypeDistribution()` â†’ `[NoteType: Int]`
   - `fetchAccuracyTrend(range:)` â†’ `[(Date, Float)]`
   - `fetchLearningStats()` â†’ `LearningStats`

2. **Build chart views** using Swift Charts framework:
   - `Chart { BarMark(...) }` for capture activity
   - `Chart { SectorMark(...) }` for type breakdown
   - `Chart { LineMark(...) }` for accuracy trend

3. **Create StatisticsView** composing the chart views

4. **Add navigation** from Settings or as new tab

5. **Add date range picker** for filtering (week/month/year/all time)

### Swift Charts Example

```swift
import Charts

struct CaptureChartView: View {
    let data: [CaptureDay]

    var body: some View {
        Chart(data) { day in
            BarMark(
                x: .value("Date", day.date, unit: .day),
                y: .value("Notes", day.count)
            )
            .foregroundStyle(Color.forestMedium)
        }
        .chartXAxis {
            AxisMarks(values: .stride(by: .day)) { _ in
                AxisValueLabel(format: .dateTime.weekday(.narrow))
            }
        }
    }
}
```

### Estimated Scope
- New files: ~400 lines total (ViewModel + 4 View files)
- Modifications: ~10 lines (adding tab/navigation)
- Uses Swift Charts (built into iOS 16+)

---

## Implementation Order Recommendation

1. **PDF Export** (2-3 hours)
   - Most immediately useful for sharing notes
   - Follows existing patterns closely

2. **Capture Statistics** (3-4 hours)
   - Nice-to-have but builds engagement
   - Good candidate for user contribution (chart customization)

---

## Questions for Review

### PDF Export
1. Should PDF be a primary export destination (shown prominently) or secondary?
2. Include watermark/branding in footer?
3. Support for password-protected PDFs?

### Statistics
1. Add as 4th tab or section within Settings?
2. Include "insights" like "You capture most notes on Mondays"?
3. Gamification elements (streaks, achievements)?
