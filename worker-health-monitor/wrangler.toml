name = "worker-health-monitor"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Cron trigger - runs every 5 minutes
[triggers]
crons = ["*/5 * * * *"]

# KV namespace for storing health metrics and failure counts
# Create with: wrangler kv:namespace create HEALTH_METRICS
# Then update the id below with the output
[[kv_namespaces]]
binding = "HEALTH_METRICS"
id = "REPLACE_WITH_ACTUAL_KV_ID"

# Public environment variables
[vars]
# URLs to monitor
TESTFLIGHT_WORKER_URL = "https://testflight-welcome-worker.YOUR_SUBDOMAIN.workers.dev"
API_PROXY_WORKER_URL = "https://api-proxy-worker.YOUR_SUBDOMAIN.workers.dev"

# Thresholds
MAX_CONSECUTIVE_FAILURES = 3
RESPONSE_TIME_THRESHOLD_MS = 5000
SUSTAINED_SLOW_DURATION_MIN = 15

# Linear Team ID for QuillStack
LINEAR_TEAM_ID = "e2da77ea-ff59-46e5-b777-9bf4dd7c855d"

# Secrets (set via CLI with wrangler secret put):
# - LINEAR_API_KEY (Linear API key for creating issues)
# - AMPLITUDE_API_KEY (Amplitude API key for metrics tracking)
# - MANUAL_TRIGGER_API_KEY (API key for /check-now endpoint authentication)
